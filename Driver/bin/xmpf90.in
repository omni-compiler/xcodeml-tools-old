#!/bin/bash

# $TSUKUBA_Release: Omni OpenMP Compiler 3 $
# $TSUKUBA_Copyright:
#  PLEASE DESCRIBE LICENSE AGREEMENT HERE
#  $

BINDIR=`dirname $0`
args=()
prev_args=''
for i in "$@"; do
    case ${prev_args} in
        -M)
            args=("${args[@]}" "-M${i}" "-moddir${i}")
            prev_args='';;
        *)
            case "${i}" in
#               -fopenmp)
#                   args=("${args[@]}" "--Wf-fopenmp")
#                   for j in "@OMF_CONF_LNK_OPT@"; do
#                       args=("${args[@]}" "--Wn${j}")
#                   done;;
                -J?*)
                    foo=`echo ${i}|sed 's/^-J/-M/'`
                    bar=`echo ${i}|sed 's/^-J/-moddir/'`
                    args=("${args[@]}" "${foo}" "${bar}");;
                -J)
                    prev_args="-M";;
                -tmp)
                    args=("${args[@]}" "--Wn${i}");;
		-openmp|-omp)
#		    args=("${args[@]}" "-fopenmp")
		    args=("${args[@]}" "-openmp");;
                *)
                    args=("${args[@]}" "${i}");;
            esac;;
    esac
done

set -- "${args[@]}"

${BINDIR}/omdriver --xf -Txmpf "$@"

exit $?

